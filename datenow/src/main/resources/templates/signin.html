<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>DateNow â€“ ë¡œê·¸ì¸</title>
  <link rel="stylesheet" th:href="@{/css/signin.css}" />
</head>
<body>
<div class="signin-container">
  <h1 class="logo">ğŸ’– DateNow.</h1>

  <form id = "signinForm">
    <div class="field">
      <label for="userId">ì•„ì´ë””</label>
      <input type="text" id="userId" name = "userId" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”." />
    </div>

    <div class="field">
      <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
      <input type="password" id="password" name = "password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”." />
    </div>

<!--    <label class="remember-label">-->
<!--      <input type="checkbox" name="remember-me" class="remember-checkbox" />-->
<!--      ë¡œê·¸ì¸ ìœ ì§€-->
<!--    </label>-->

    <button type="button" class="btn-login" id="loginBtn">ë¡œê·¸ì¸</button>
  </form>
  <div style="margin-top: 20px; text-align: center;">
    <a href="/oauth2/authorization/github" style="
    display: inline-block;
    padding: 10px 20px;
    background-color: #24292e;
    color: white;
    border-radius: 5px;
    text-decoration: none;
    font-weight: bold;">
      <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
           alt="GitHub" style="height: 20px; vertical-align: middle; margin-right: 8px;" />
      GitHubë¡œ ë¡œê·¸ì¸
    </a>
  </div>

  <div class="links">
    <a th:href="@{/member/signup}">ì•„ì§ íšŒì›ì´ ì•„ë‹ˆì‹ ê°€ìš”?</a>
  </div>
  <div class="links">
    <a th:href="@{/member/find-password}">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
  </div>
</div>
<script>
  const params = new URLSearchParams(window.location.search);
  const error = params.get("error");

  if (error) {
    alert(error);
  }
</script>

<div th:if="${param.msg}" th:text="${param.msg}" id="alert-msg" style="display:none;"></div>
<script>
  document.querySelector("#loginBtn").addEventListener("click", async ev => {
    const userId = document.querySelector("#userId").value;
    const password = document.querySelector("#password").value;

    const res = await fetch("/auth/signin", {
      method:"POST",
      body:JSON.stringify({"username":userId, "password":password}),
      headers:{
        "Content-Type":"application/json"
      }
    });

    if(!res.ok){
      const data = await res.json()
      alert(data.message)
    }

    if(res.ok) location.href = "/";
  })
</script>
</body>
</html>